<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabjiiwala | Login</title>
    <link rel="stylesheet" href="/assets/css/universal.css">
    <link rel="stylesheet" href="/assets/css/login.css">
    <link rel="shortcut icon" href="/assets/images/favicon/favicon.ico" type="image/x-icon">
</head>

<body>

    <div class="login-container">
        <div class="login-child">
            <h1>Sabjiiwala</h1>
        </div>
        <div class="login-child">
            <h1>Login</h1>
            <input type="email" name="email" id="email-input" placeholder="Email">
            <input type="password" name="password" id="password-input" placeholder="Password">
            <button type="submit" id="loginBtn">Login</button>
            <p id="error-message"></p>
        </div>
    </div>

    <script src="/assets/js/universal.js"></script>
    <script src="/assets/js/login.js" type="module"></script>

    <script type="module">

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBYrMx0cJd-wXYvLPod8gFs5oURJWShjB8",
            authDomain: "sabjiiwala-86477.firebaseapp.com",
            projectId: "sabjiiwala-86477",
            storageBucket: "sabjiiwala-86477.appspot.com",
            messagingSenderId: "141662332260",
            appId: "1:141662332260:web:fd26ff72c658c64cc20671",
            measurementId: "G-S24PM4NJB7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);

        const submit_btn = document.getElementById("loginBtn")
        submit_btn.addEventListener("click", () => {
            const errorMsg = document.getElementById('error-message');
            const email = document.getElementById("email-input").value;
            const password = document.getElementById("password-input").value;
            if (email == "admin" && password == "admin123") {
                localStorage.setItem("uid", "admin");
                window.open("/pages/admin.html", "_self");
            } else if (email != '' && password != '') {
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed in 
                        let user = userCredential.user;
                        localStorage.setItem("uid", user.uid);
                        window.open("/pages/register.html", "_self");
                        // ...
                    })
                    .catch((error) => {
                        let errorCode = error.code;
                        let errorMessage = error.message;
                        if (errorMessage == "Firebase: Error (auth/email-already-in-use).") {
                            signInWithEmailAndPassword(auth, email, password)
                                .then((userCredential) => {
                                    // Signed in 
                                    let user = userCredential.user;
                                    localStorage.setItem("uid", user.uid);
                                    window.open("/pages/dashboard.html", "_self");
                                    // ...
                                })
                                .catch((error) => {
                                    errorCode = error.code;
                                    errorMessage = error.message;
                                    errorMsg.innerHTML = error;
                                });

                        } else {
                            errorMsg.innerHTML = errorMessage;
                        }
                        // ..
                    });
            } else if(email == ''){
                errorMsg.innerHTML = "Enter a valid email"
            } else if(password == ''){
                errorMsg.innerHTML = 'Enter a valid password'
            }
        });
    </script>

</body>

</html>